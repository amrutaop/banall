#  Copyright (c) 2023 @III_AMRITA_III- @III_AMRITA_III
# Telegram Ban All Bot 
# Creator - @III_AMRITA_III

import logging
import re
import os
import sys
import asyncio
from telethon import TelegramClient, events
import telethon.utils
from telethon.tl import functions
from telethon.tl.functions.channels import LeaveChannelRequest
from asyncio import sleep
from telethon.tl.types import ChatBannedRights, ChannelParticipantsAdmins, ChatAdminRights
from telethon.tl.functions.channels import EditBannedRequest
from datetime import datetime
from var import Var
from time import sleep
from telethon.errors.rpcerrorlist import FloodWaitError
from telethon.tl import functions
from telethon.tl.types import (
    ChannelParticipantsAdmins,
    ChannelParticipantsKicked,
    ChatBannedRights,
    UserStatusEmpty,
    UserStatusLastMonth,
    UserStatusLastWeek,
    UserStatusOffline,
    UserStatusOnline,
    UserStatusRecently,
)

RIGHTS = ChatBannedRights(
    until_date=None,
    view_messages=True,
    send_messages=True,
    send_media=True,
    send_stickers=True,
    send_gifs=True,
    send_games=True,
    send_inline=True,
    embed_links=True,
)


logging.basicConfig(level=logging.INFO)

print("ğ’ğ­ğšğ«ğ­ğ¢ğ§ğ   ğğšğ§ğšğ¥ğ¥ ğğ¨ğ­.....")

Bgt = TelegramClient('Bgt', Var.API_ID, Var.API_HASH).start(bot_token=Var.BOT_TOKEN)


SUDO_USERS = []
for x in Var.SUDO: 
    SUDO_USERS.append(x)

@Bgt.on(events.NewMessage(pattern="/ping"))  
async def ping(e):
    if e.sender_id in SUDO_USERS:
        start = datetime.now()
        text = "Pong!"
        event = await e.reply(text, parse_mode=None, link_preview=None )
        end = datetime.now()
        ms = (end-start).microseconds / 1000
        await event.edit(f"**ğˆ'ğŒ ğ‘ğ®ğ§ ğŸ¥€** \n\n ğŸŒ¹ ğğ¨ğ§ğ  ğŸŒ¹!! `{ms}` ms")


@Bgt.on(events.NewMessage(pattern="/kickall"))
async def kickall(event):
   if event.sender_id in SUDO_USERS:
     if not event.is_group:
         Reply = f"ğƒğğšğ« ğŒğšğ¬ğ­ğğ« ğŸ˜— !! ğ“ğ¡ğ¢ğ¬ ğ‚ğ¦ğ ğğ§ğ¥ğ² ğ”ğ¬ğ ğˆğ§ ğ€ğ§ğ² ğ†ğ«ğ¨ğ®ğ© ğŸ˜’"
         await event.reply(Reply)
     else:
         await event.delete()
         Bgt = await event.get_chat()
         BgtoeLop = await event.client.get_me()
         admin = Bgt.admin_rights
         creator = Bgt.creator
         if not admin and not creator:
              return await event.reply("ğˆ ğƒğ¨ğ§'ğ­ ğ‡ğšğ¯ğ ğ…ğ®ğ¥ğ¥ ğ€ğğ¦ğ¢ğ§ ğ‘ğ¢ğ ğ¡ğ­ğ¬ ğŸ˜’ !!")
         Bgtop = await Bgt.send_message(event.chat_id, "**ğ‡ğğ² ğŒğšğ¬ğ­ğğ« !! ğˆ'ğ¦ ğ€ğ¥ğ¢ğ¯ğ ğŸ’**")
         admins = await event.client.get_participants(event.chat_id, filter=ChannelParticipantsAdmins)
         admins_id = [i.id for i in admins]
         all = 0
         kimk = 0
         async for user in event.client.iter_participants(event.chat_id):
             all += 1
             try:
                if user.id not in admins_id:
                    await event.client.kick_participant(event.chat_id, user.id)
                    kick += 1
                    await asyncio.sleep(0.1)
             except Exception as e:
                    print(str(e))
                    await asyncio.sleep(0.1)
         await Bgtop.edit(f"**ğ”ğ¬ğğ«ğ¬ ğŠğ¢ğœğ¤ğğ ğ’ğ®ğœğœğğ¬ğ¬ğŸğ®ğ¥ğ¥ğ² ğŸ˜— ! \n\n ğŠğ¢ğœğ¤ğğ ğŸ‘‰:** `{kick}` \n **ğ“ğ¨ğ­ğšğ¥ ğŸ¤:** `{all}`")
    

@Bgt.on(events.NewMessage(pattern="/banall"))
async def banall(event):
   if event.sender_id in SUDO_USERS:
     if not event.is_group:
         Reply = f"ğƒğğšğ« ğŒğšğ¬ğ­ğğ« ğŸ˜— !! ğ“ğ¡ğ¢ğ¬ ğ‚ğ¦ğ ğğ§ğ¥ğ² ğ”ğ¬ğ ğˆğ§ ğ€ğ§ğ² ğ†ğ«ğ¨ğ®ğ© ğŸ˜’."
         await event.reply(Reply)
     else:
         await event.delete()
         Bgt = await event.get_chat()
         Bgtop = await event.client.get_me()
         admin = Bgt.admin_rights
         creator = Bgt.creator
         if not admin and not creator:
              return await event.reply("ğˆ ğƒğ¨ğ§'ğ­ ğ‡ğšğ¯ğ ğ…ğ®ğ¥ğ¥ ğ€ğğ¦ğ¢ğ§ ğ‘ğ¢ğ ğ¡ğ­ğ¬ ğŸ™‚ !!")
         BgtoeL = await Bgt.send_message(event.chat_id, "**ğ‡ğğ² ğŒğšğ¬ğ­ğğ« ğˆ'ğ¦ ğ€ğ¥ğ¢ğ¯ğ ğŸ’**")
         admins = await event.client.get_participants(event.chat_id, filter=ChannelParticipantsAdmins)
         admins_id = [i.id for i in admins]
         all = 0
         ban = 0
         async for user in event.client.iter_participants(event.chat_id):
             all += 1
             try:
               if user.id not in admins_id:
                    await event.client(EditBannedRequest(event.chat_id, user.id, RIGHTS))
                    ban += 1
                    await asyncio.sleep(0.1)
             except Exception as e:
                   print(str(e))
                   await asyncio.sleep(0.1)
         await BgtoeL.edit(f"**ğŸ¤« ğ”ğ¬ğğ«ğ¬ ğğšğ§ğ§ğğ ğ’ğ®ğœğœğğ¬ğ¬ğ…ğ®ğ¥ğ¥ğ² ! \n\n ğğšğ§ğ§ğğ ğ”ğ¬ğğ«ğ¬ ğŸ‘»:** `{ban}` \n ** ğ“ğ¨ğ­ğšğ¥ ğ”ğ¬ğğ« ğŸ’Œ:** `{all}`")

    
@Bgt.on(events.NewMessage(pattern="/unbanall"))
async def unban(event):
   if event.sender_id in SUDO_USERS:
     if not event.is_group:
         Reply = f"ğƒğğšğ« ğŒğšğ¬ğ­ğğ« ğŸ˜— !! ğ“ğ¡ğ¢ğ¬ ğ‚ğ¦ğ ğğ§ğ¥ğ² ğ”ğ¬ğ ğˆğ§ ğ€ğ§ğ² ğ†ğ«ğ¨ğ®ğ© ğŸ˜’."
         await event.reply(Reply)
     else:
         msg = await event.reply("ğ’ğğšğ«ğœğ¡ğ¢ğ§ğ  ğğšğ«ğ­ğ¢ğœğ¢ğ©ğšğ§ğ­ ğ‹ğ¢ğ¬ğ­ğ¬ ğŸ”.")
         p = 0
         async for i in event.client.iter_participants(event.chat_id, filter=ChannelParticipantsKicked, aggressive=True):
              rights = ChatBannedRights(until_date=0, view_messages=False)
              try:
                await event.client(functions.channels.EditBannedRequest(event.chat_id, i, rights))
              except FloodWaitError as ex:
                 print(f"ğ’ğ©ğğğ©ğ¢ğ§ğ  ğ…ğ¨ğ« {ex.seconds} ğ’ğğœ...")
                 sleep(ex.seconds)
              except Exception as ex:
                 await msg.edit(str(ex))
              else:
                  p += 1
         await msg.edit("{}: {} unbanned".format(event.chat_id, p))
         
         
@Bgt.on_message(filters.command("start") & filters.private & ~filters.edited)
async def start_(client: Client, message: Message):
    await message.reply_photo(
        photo=f"{BOT_IMAGE}",
        caption=f"""**â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¥ ğ‡ğ¢  ğˆ'ğ¦ ğ€ ğ€ğğ¯ğšğ§ğœğ ğğšğ§ ğšğ¥ğ¥ ğğ¨ğ­ ğŸŒ·.\n\nğŸ“Œ ğŒğ² ğğšğ¦ğ ğˆğ¬ ğğšğ§ ğšğ¥ğ¥ ğğ¨ğ­ ğŸŒ· ğ…ğ¨ğ«ğ¦ ğˆğ§ğğ¢ğš ğŸ‡®ğŸ‡³ 

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”£â¥ï¸ â™•ï¸ğğ°ğ§ğğ«â™•ï¸   Â» [ğ‚ğ¥ğ¢ğœğ¤ ğ‡ğğ«ğ](https://t.me/{OWNER_USERNAME})
â”£â¥ï¸ ğ”ğ©ğğšğ­ğğ¬ âª Â» [ğ‚ğ¥ğ¢ğœğ¤ ğ‡ğğ«ğ](https://t me/{UPDATES_CHANNEL})
â”£â¥ï¸ ğ’ğ®ğ©ğ©ğ¨ğ«ğ­ âª Â» [ğ‚ğ¥ğ¢ğœğ¤ ğ‡ğğ«ğ](https://t.me/{SUPPORT_GROUP})
â”£â¥ï¸ ğ‚ğ«ğğšğ­ğ¨ğ« âª Â» [ğ€á´Ê€Éªá´›á´€](https://t.me/III_AMRITA_III)
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

ğŸ’ ğ‰ğ®ğ¬ğ­ ğ€ğğ ğŒğ Â» ğ“ğ¨ ğ˜ğ¨ğ®ğ« ğ†ğ«ğ¨ğ®ğ© ğ€ğ§ğ
ğ„ğ§ğ£ğ¨ğ² ğ’ğ®ğ©ğğ« ğğ®ğšğ¥ğ¢ğ­ğ² â¥ï¸ ğŠğ¢ğœğ¤
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”**""",
    reply_markup=InlineKeyboardMarkup(
            [
                [
                    InlineKeyboardButton(
                        "â• â° ğ€ğğ ğŒğ ğ“ğ¨ ğ˜ğ¨ğ®ğ« ğ†ğ«ğ¨ğ®ğ© â± â•", url=f"https://t.me/{BOT_USERNAME}?startgroup=true")
                ]
                
           ]
        ),
    )


@Bgt.on(events.NewMessage(pattern="/leave"))
async def _(e):
    if e.sender_id in SUDO_USERS:
        Bgtop = ("".join(e.text.split(maxsplit=1)[1:])).split(" ", 1)
        if len(e.text) > 7:
            bc = Bgtoel[0]
            bc = int(bc)
            text = "ğ‹ğğ¯ğ¢ğ§ğ  ğŸš¶â€â™‚ï¸....."
            event = await e.reply(text, parse_mode=None, link_preview=None )
            try:
                await event.client(LeaveChannelRequest(bc))
                await event.edit("ğ’ğ®ğœğœğğ¬ğ¬ğŸğ®ğ¥ğ¥ğ² ğ¥ğğŸğ­ ğŸ­")
            except Exception as e:
                await event.edit(str(e))   
        else:
            bc = e.chat_id
            text = "ğ‹ğğ¯ğ¢ğ§ğ  ğŸš¶â€â™‚ï¸....."
            event = await e.reply(text, parse_mode=None, link_preview=None )
            try:
                await event.client(LeaveChannelRequest(bc))
                await event.edit("ğ’ğ®ğœğœğğ¬ğ¬ğŸğ®ğ¥ğ¥ğ² ğ¥ğğŸğ­ ğŸ­")
            except Exception as e:
                await event.edit(str(e))   
          

@Bgt.on(events.NewMessage(pattern="/restart"))
async def restart(e):
    if e.sender_id in SUDO_USERS:
        text = "ğŸ”ƒ ğ‘ğğ¬ğ­ğšğ«ğ­ğ¢ğ§ğ  ğŸ”„ !!!"
        await e.reply(text, parse_mode=None, link_preview=None )
        try:
            await Bgt.disconnect()
        except Exception:
            pass
        os.execl(sys.executable, sys.executable, *sys.argv)
        quit()


print(" ğ‡ğ¢ ğƒğğšğ« ğŒğšğ¬ğ­ğğ« \n\n")
print("ğ˜ğ¨ğ®ğ« ğğšğ§ğšğ¥ğ¥ ğğ¨ğ­ ğƒğğ©ğ¥ğ¨ğ²ğğ ğ’ğ®ğœğœğğ¬ğ¬ğŸğ®ğ¥ğ¥ğ²  âœ…")

Bgt.run_until_disconnected()
